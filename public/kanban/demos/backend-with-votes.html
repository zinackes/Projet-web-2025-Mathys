<!DOCTYPE html>
<html>
	<head>
		<meta name="author" content="XB Software" />
		<meta name="publisher" content="XB Software" />
		<meta name="copyright" content="XB Software" />
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1,  user-scalable=no, shrink-to-fit=no"
		/>
		<link rel="icon" href="../favicon.ico" type="image/x-icon" />
		<link rel="icon" href="../assets/favicon/icon-16.png" sizes="16x16" />
		<link rel="icon" href="../assets/favicon/icon-32.png" sizes="32x32" />
		<link rel="icon" href="../assets/favicon/icon-48.png" sizes="48x48" />
		<link rel="icon" href="../assets/favicon/icon-96.png" sizes="96x96" />
		<link
			rel="icon"
			href="../assets/favicon/icon-144.png"
			sizes="144x144"
		/>

		<!-- Kanban -->
		<link rel="stylesheet" href="../dist/kanban.css" />
		<script src="../dist/kanban.js"></script>

		<!-- Demo data -->
		<script src="./common/data.js"></script>
		<script src="./common/login.js"></script>
		<link rel="stylesheet" href="../assets/demos.css" />

		<title>Backend for comments and votes</title>

		<style>
			.auth-select {
				padding: 4px;
				border: 1px solid #d2cfcf;
				font-size: 14px;
				height: 32px;
				width: 200px;
				margin: 5px 0 10px;
			}

			.auth-btn {
				display: inline-block;
				vertical-align: middle;
				max-width: 100%;
				min-width: 200px;
				font-weight: 500;
				color: #fff;
				cursor: pointer;
				font-size: 16px;
				padding: 6px 16px;
				border: none;
				background: #027ABC;
			}

			.auth-content {
				width: 150px;
				height: 200px;
			}
		</style>
	</head>

	<body>
		<div class="g-wrap">
			<header class="g-header">
				<div class="h-wrap">
					<div class="h-nav">
						<a href="../index.html">Back to demos</a>
					</div>
					<div class="h-title">
						Backend for comments and votes. Check
						<a
							href="https://github.com/web-widgets/kanban-node"
							target="_blank"
							>Node.js</a
						>
						and
						<a
							href="https://github.com/web-widgets/kanban-go"
							target="_blank"
							>Go</a
						>
						examples
					</div>
					<div class="h-cta">
						<a
							href="https://dhtmlx.com/docs/products/dhtmlxKanban/download.shtml"
							target="_blank"
							class="g-btn"
							>Free Trial</a
						>
					</div>
				</div>
			</header>

			<div id="auth-container" style="display: flex; justify-content: center; align-items: center; height: 100%; flex-direction: column;">
				<div id="auth-content" class="auth-content"></div>
			</div>

			<div id="toolbar"></div>
			<div id="root"></div>
		</div>

		<script>
			const { users } = getData();

			const { Kanban, Toolbar, RestDataProvider, defaultEditorShape, defaultCardShape } = kanban;

			// Check Go backend repository here -  https://github.com/web-widgets/kanban-go
			const url = "https://docs.dhtmlx.com/kanban-backend";
			const restProvider = new RestDataProvider(url);

			loginWithUser(initKanban, restProvider, url, "auth-container");

			function initKanban(restProvider, url, token, userId) {
				Promise.all([
					restProvider.getCards(),
					restProvider.getColumns(),
					restProvider.getRows(),
				]).then(([cards, columns, rows]) => {
					restProvider.setHeaders({
						"Remote-Token": token,
					});
					const cardShape = {
						...defaultCardShape,
						label: true,
						description: true,
						progress: true,
						start_date: true,
						end_date: true,
						priority: true,
						color: true,
						cover: true,
						attached: true,
						users: {
							show: true,
							values: users
						},
						votes: {
							show: true,
							clickable: true,
						},
						comments: true,
					};
					const editorShape = [
						...defaultEditorShape,
						{
							key: "attached",
							type: "files",
							label: "Files",
							uploadURL: url + "/uploads",
						},
						{
							type: "comments",
							key: "comments",
							label: "Comments",
							config: {
								placement: "editor",
							},
						},
					];

					const board = new Kanban("#root", {
						cards,
						columns,
						rows,
						rowKey: "row",
						cardShape,
						editorShape,
						currentUser: parseInt(userId),
					});
					board.api.setNext(restProvider);
					new Toolbar("#toolbar", { api: board.api });
				});
			}
		</script>
	</body>
</html>
